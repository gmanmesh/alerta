<!DOCTYPE html>
<html>
<head>
  <title>Email Verification</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
</head>
<body>
  <h1>Verifying your email...</h1>
  <script>
    const supabaseUrl = 'https://myproject.supabase.co';
    const supabaseKey = 'my-public-key'; 
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');

    // Replace with your app URL
    const appUrl = 'http://192.168.100.29:8081';

    async function handleVerification() {
      if (token) {
        // verify the token with Supabase
        // But usually, the link already verifies the email
        // So we can just wait and redirect

        // Fetch user info to confirm email verification
        const { data: { user } } = await supabase.auth.getUser();

        if (user && user.email_confirmed_at) {
          // Email is verified
          window.location.href = `${appUrl}?verification=success`;
        } else {
          // Not verified yet or user not logged in
          // For email verification, the user might need to log in first
          // Or, just redirect after some delay
          setTimeout(() => {
            window.location.href = `${appUrl}?verification=done`;
          }, 2000);
        }
      } else {
        // Invalid link
        window.location.href = `${appUrl}?verification=failed`;
      }
    }

    handleVerification();
  </script>
</body>
</html>
